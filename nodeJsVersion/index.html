<!DOCTYPE html>
<html lang="en">
<head>
<!--
Honor Code: I acknowledge that this code represents my own work: 
Initials: MJR    
Date: October 14th, 2019
-->
<meta charset="UTF-8" />
<meta name="author" content="Mason Rich" />
<meta name="description" content="Egyptian Ratscrew" />
<meta name="keywords" content="Egyptian Ratscrew, cards, face cards, game" />

<!-- scaling for devices -->
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css">
 

<!-- jQuery library -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

<!-- Popper JS -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"></script>

<!-- Latest compiled JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"></script>
<script src="jquery-3.4.1.mins.js"></script>
    
<!-- link for glyphicons -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet"/>

<!-- FONT AWESOME -->
<link href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">
    
<!-- Link for google font -->
<link href="https://fonts.googleapis.com/css?family=Hind" rel="stylesheet">

<!-- My style sheet -->
<link href="/styles/game.css" rel="stylesheet" type="text/css"/>
    
<script src="scripts/game.js"></script>


<link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    
<link href="/styles/cards.css" rel="stylesheet" type="text/css">

    
<title>Egyptian Ratscrew</title> 
</head>      
   <body>
       <div class="container-fluid">
       <!-- Jumbo Tron -->
       <div class="jumbotron">
           <h3><strong>EGYPTIAN RATSCREW</strong></h3>
       </div>
       
       <nav class="navbar navbar-expand-md">
           
           
           <!-- BUTTON FOR SMALL SCREENS -->
           <button class="navbar-toggler" data-toggle="collapse" data-target="#collapse_target">
              <span><i class="fa fa-bars"></i></span>
           </button>
           
           <div class="collapse navbar-collapse" id="collapse_target">
              <a href="index.html" class ="navbar-brand">
                   <span class="fa fa-home" active="active" aria-hidden="true"></span>
              </a>
                     
              <ul class="navbar-nav ml-auto">
                 <li class="nav-item" onclick='startGame()'><a id="start-game" class="nav-link" href="#">Start</a> </li>
                 <li class="nav-item" onclick='endGame()'><a id="end-game" class="nav-link" href="#" >End</a></li>
                  <li class="nav-item"><a class="nav-link" href="rules.html" ><i class="fa fa-question-circle"></i></a></li>
              </ul> 
           </div>
       
       </nav>
       
       <section>
           
               <!-- Top Section -->
               <div class="row">
                   
                  <section id="topsection" class="col-sm-12 col-md-12 col-xs-12 col-lg-12 col-xl-12">
                    
                 
                  </section>
           
           
                </div>
           
                <!-- Middle Section -->
                <div class="row" id="rowsize">
                   
                   <!-- left side -->
                   <section id="leftsection" class="col-sm-12 col-md-4 col-xs-12 col-lg-4 col-xl-4">
                       <div>
                          <fieldset>
                             <label>Player 1</label>
                              <hr>
                             <img src="/cards/RED_BACK.svg" alt="Back of card">
                             <p class="cardsP">CARDS</p>
                             <p id=numCardsPlayer1>26</p>
                          </fieldset>
                        </div>
                   </section>
                   
                   <!-- Middle of Middle Section -->
                   <section id="middlesection" class="col-sm-12 col-md-4 col-xs-12 col-lg-4 col-xl-4">
                       <div>
                          <fieldset>
                             <label>PILE</label> 
                              <hr>

                              <div id="cardHolder" class="hand fan active-hand" style="width: 318px; height: 154px;">

                             
                                    <img class="card" id="card1" src="/cards/QS.svg" style="left: 50px; top: 6px; transform: rotate(350deg) translateZ(0px);">
                                    <img class="card" id="card2" src="/cards/JS.svg" style="left: 68px; top: 4px; transform: rotate(352deg) translateZ(0px);">
                                    <img class="card" id="card3" src="/cards/10S.svg" style="left: 86px; top: 2px; transform: rotate(355deg) translateZ(0px);">
                                    <img class="card" id="card4" src="/cards/9H.svg" style="left: 104px; top: 0px; transform: rotate(357deg) translateZ(0px);">
                                    <img class="card" id="card5" src="/cards/3H.svg" style="left: 122px; top: 0px; transform: rotate(360deg) translateZ(0px);">
                                  
                       
	                           </div>
                              
                              <button id="slapButton" onclick='preSlap()'>SLAP</button>
                              
                              
                              <button id="PlayCardButton" onclick='prePlayCard()'>PLAY CARD</button>
                              
                              <p style="font-size: 48px;" id="label"></p>
                                  
                           </fieldset>
                        </div>
                   </section>
                   
                   <!-- Right side -->
                   <section id="rightsection" class="col-sm-12 col-md-4 col-xs-12 col-lg-4 col-xl-4">
                       <div>
                          <fieldset>
                             <label>Player 2</label> 
                              <hr>
                             <img class="draggable" src="/cards/RED_BACK.svg" alt="Back of card">
                             <p class="cardsP">CARDS</p>
                             <p id=numCardsPlayer2>26</p>
                           </fieldset>
                        </div>
                   </section>
                   
               </div>
               <hr>
           
               <!-- Radio Buttons breakfast, lunch, dinner -->
               <div class="row">
           
           
               </div>
       
       
       </section>
      
      
      
     <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
     <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
     <script type="text/javascript" src="scripts/game.js"></script>

     <!--<script src="scripts/cards.js"></script>-->
     <script>   
            (function (i, s, o, g, r, a, m) {
                i['GoogleAnalyticsObject'] = r; i[r] = i[r] || function () {
                    (i[r].q = i[r].q || []).push(arguments)
                }, i[r].l = 1 * new Date(); a = s.createElement(o),
          m = s.getElementsByTagName(o)[0]; a.async = 1; a.src = g; m.parentNode.insertBefore(a, m)
            })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');

            ga('create', 'UA-60043592-1', 'auto');
            ga('send', 'pageview');

       </script> 
           
    <script>
        
        function startGame() {
            $.get('/getGame', function(data, status) {
                
                 document.getElementById("card5").src = "cards/blank.jpeg"; 
                 document.getElementById("card4").src = "cards/blank.jpeg"; 
                 document.getElementById("card3").src = "cards/blank.jpeg"; 
                 document.getElementById("card2").src = "cards/blank.jpeg"; 
                 document.getElementById("card1").src = "cards/blank.jpeg"; 
                
                //TODO: Replace 'Player 1'/'Player 2' with the name they give
                 if (data === '0') {
                       document.getElementById("label").innerHTML = "Player 1 goes first"; 
                 } else {
                      document.getElementById("label").innerHTML = "Player 2 goes first";  
                 }
                
            });
        }   
        
        function prePlayCard() {
                        let start;
            
            $.get('/gameStart', function(data, status) {
                
                start = data;

                playCard(start);
            });
            

        }
        
        function playCard(start) {
            
            document.getElementById("label").innerHTML = "";
            
            if (!start) {
                console.log('bleh');
                return;
            }
                
            $.get('/playCard', function(data, status) {
                
            }); 
            
            DisplayTop5();
            
        }
        
        
        function DisplayTop5() {
                       
            $.get('/displayTop5', function(data, status) {
                
                let pile = JSON.parse(data);

                if (pile.length > 0) {
                    document.getElementById("card5").src = "cards/" + pile[0] + ".svg";
                }

                if (pile.length > 1) {
                   document.getElementById("card4").src = "cards/" + pile[1] + ".svg";
                }

                if (pile.length > 2) {
                     document.getElementById("card3").src = "cards/" + pile[2] + ".svg";
                }

                if (pile.length > 3) {
                    document.getElementById("card2").src = "cards/" + pile[3] + ".svg";
                }

                if (pile.length > 4) {
                    document.getElementById("card1").src = "cards/" + pile[4] + ".svg";
                } 
                
                GetCount();
            }); 
            
        }  
        
        function GetCount() {
             $.get('/getCount', function(data, status) {
                    HasPreviousFaceCard(data);
             });
            
             DidGameEnd();
        }
        
        function DisplayTop5Simple()
        {            
            $.get('/displayTop5', function(data, status) {
                
                let pile = JSON.parse(data);

                if (pile.length > 0) {
                    document.getElementById("card5").src = "cards/" + pile[0] + ".svg";
                }

                if (pile.length > 1) {
                   document.getElementById("card4").src = "cards/" + pile[1] + ".svg";
                }

                if (pile.length > 2) {
                     document.getElementById("card3").src = "cards/" + pile[2] + ".svg";
                }

                if (pile.length > 3) {
                    document.getElementById("card2").src = "cards/" + pile[3] + ".svg";
                }

                if (pile.length > 4) {
                    document.getElementById("card1").src = "cards/" + pile[4] + ".svg";
                } 
            }); 
        }
        
        function HasPreviousFaceCard(count)
        {
            $.get('/hasPreviousFaceCard', function(data2, status2) {

                //console.log("count: " + count + " data2: " + data2);
                
                if (count === '0' && data2) {
                    DisplayTop5Simple();
                    ClearServerPile();
                    GetWait();
                }
            });   
        }
        
        function EmptyPile() {
            $.get('/emptyPile', function(data2, status2) {
                
            })
        }
        
        function ClearServerPile() {
            $.get('/clearPile', function(data2, status2) {
                
            })
        }
        
        function GetWait()
        {
            
            $.get('/getWait', function(data, status) {
            if(data) {

                ToggleGameStart();
                
                document.getElementById("label").innerHTML = "Pile Won!"; 

                 setTimeout( function() {
                 
                 document.getElementById("card5").src = "cards/blank.jpeg"; 
                 document.getElementById("card4").src = "cards/blank.jpeg"; 
                 document.getElementById("card3").src = "cards/blank.jpeg"; 
                 document.getElementById("card2").src = "cards/blank.jpeg"; 
                 document.getElementById("card1").src = "cards/blank.jpeg"; 

                 ToggleGameStart();
                 document.getElementById("label").innerHTML = "";

                }, 1300);
                
                } else {
                    
                  document.getElementById("card5").src = "cards/blank.jpeg"; 
                  document.getElementById("card4").src = "cards/blank.jpeg"; 
                  document.getElementById("card3").src = "cards/blank.jpeg"; 
                  document.getElementById("card2").src = "cards/blank.jpeg"; 
                  document.getElementById("card1").src = "cards/blank.jpeg";    
                }
            })
        }
        
        function ToggleGameStart()
        {            
            $.get('/toggleGameStart', function(data4, status4) {

            });
        }  
        
        function preSlap() {
            
            $.get('/gameStart', function(data, status) {
            
                if (!data) {

                    return;
                }
                slap();
            });
        }
        
        //still not done, need to look into it more
        function slap(){
            

            
            $.get('/IsPileSlappable', function(data, status){
            
                let slappable = data;

                if (slappable) {
                    ClearPile(); 
                } 
                
                console.log('Slappable: ' + slappable);       
                
                callSlap(slappable);
                
//                $.get('/displayTop5', function(data2, status2) {
//         
//                    let pile = JSON.parse(data2);
//                    
//                    console.log('Pile length: ' + pile.length);
//                    
//                    if(pile.length < 2){
//                        
//                        slappable = false;
//                        return slappable;
//                    }
//                    else if (pile[0].substring(0, 1) === pile[1].substring(0, 1)){  //just ripped this from the javascript code -AC
//                        slappable = true;
//                        return slappable;
//                    }
//                    else{
//                        console.log('more than two cards, no match');
//                        slappable = false;
//                        return slappable;
//                    }
//
//                }); 
            });            
        }
        
        function callSlap(slappable) {
            $.get('/slap', function(data, status){
                
            });    
            
            
            if (slappable) {
                document.getElementById("label").innerHTML = "SLAP!";
            }
            
            DisplayTop5Simple();
        }
        
        
        //i think this will work, not sure where to put it though - AC
        function ClearPile(){
            console.log("made it to clearpile");
            $.get('/ClearPile', function(data, status){
                let thePile = JSON.parse(data);
                //let currentPile = JSON.parse(thePile);
                console.log("the pile:" + thePile);
                if(thePile === true){
                  document.getElementById("card5").src = "cards/blank.jpeg"; 
                  document.getElementById("card4").src = "cards/blank.jpeg"; 
                  document.getElementById("card3").src = "cards/blank.jpeg"; 
                  document.getElementById("card2").src = "cards/blank.jpeg"; 
                  document.getElementById("card1").src = "cards/blank.jpeg";   
                }
                
            });
        }
        
        function DidGameEnd() {
            $.get('/gameOver', function(data, status) {
               if (data === "2")
                   return;
                
                if (data == "0") {
                    document.getElementById("label").innerHTML = "Player 1 wins!";
                } else {
                    document.getElementById("label").innerHTML = "Player 2 wins!";
                } 
            });
        }
        
        function endGame() {
            
            ClearPile();
            document.getElementById("label").innerHTML = "";
            
             $.get('/end', function(data, status){
                 
             });
        }
        
    </script>
           
</div>
   </body>

</html>